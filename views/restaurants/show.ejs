<%- include('../partials/header') %>
  <section class="box">
    <img src="<%= restaurant.image || '/images/placeholder.png' %>" alt="<%= restaurant.name %>" style="width:100%;height:200px;object-fit:cover;border-radius:6px;margin-bottom:10px" />
    <h2><%= restaurant.name %></h2>
    <p class="muted"><%= restaurant.cuisine %> • <%= restaurant.address %></p>
    <p><%= restaurant.description %></p>
    <p class="rating">★ <%= restaurant.avgRating %> from <%= restaurant.ratings.length %> reviews</p>
    <div class="actions">
      <a class="small" href="/restaurants/<%= restaurant._id %>/edit">Edit</a>
      <form method="post" action="/restaurants/<%= restaurant._id %>?_method=DELETE" onsubmit="return confirm('Delete this restaurant?')">
        <button>Delete</button>
      </form>
    </div>
    <hr />
    <h3>Leave a Rating</h3>
    <form method="post" action="/restaurants/<%= restaurant._id %>/rate">
      <input name="username" placeholder="Your name (optional)" />
      <label>Score</label>
      <select name="score"><% for(let i=5;i>=1;i--){ %> <option value="<%=i%>"><%=i%></option> <% } %></select>
      <textarea name="comment" placeholder="Say something..."></textarea>
      <button>Submit</button>
    </form>
    <h3>Recent Reviews</h3>
    <% restaurant.ratings.slice().reverse().forEach(r => { %>
      <div class="review">
        <strong><%= r.username %></strong> <span class="muted">★ <%= r.score %> • <%= new Date(r.createdAt).toLocaleDateString() %></span>
        <p><%= r.comment %></p>
      </div>
    <% }) %>
    <hr />
    <h3>Make Reservation</h3>
    <form method="post" action="/reservations">
      <input type="hidden" name="restaurantId" value="<%= restaurant._id %>" />
      <label>Name</label>
      <input name="name" required />
      <label>Phone</label>
      <input name="phone" />
      <label>Date & Time</label>
      <input type="datetime-local" name="dateTime" required />
      <label>Guests</label>
      <input type="number" min="1" name="guests" value="2" />
      <button>Reserve</button>
    </form>
  </section>
<%- include('../partials/footer') %>